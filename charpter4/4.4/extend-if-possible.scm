(define (extend-if-possible var val frame)
  (let ((binding (binding-in-frame var frame)))
    (cond (binding (unify-match (binding-value binding)
                                val
                                frame))
          ((var? val)
           (let ((binding (binding-in-frame val frame)))
             (if binding
                 (unify-match var
                              (binding-value binding)
                              frame)
                 (extend var val frame))))
          ((depends-on? val var frame)
           'failed)
          (else
           (extend var val frame)))))